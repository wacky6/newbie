{%- import "_common.tmpl" as common -%}

<!DOCTYPE html>
<html>

<head>
{{ common.meta() }}
<meta name="description" content="Jiewei Qian's blog posts.">
<meta name="keywords" content="blog, articles, Jiewei Qian">
<title>博客列表 | Jw.Q</title>
{{ common.head() }}
<link rel="stylesheet" href="blog-index.css" data-embed>
<link rel="prefetch" href="/hljs-css/railscasts.css">
</head>

<body>
{{ common.header("blog") }}

<div role="main" class="main">
<article>
    <!-- <h1>Blog posts</h1> -->

    <div class="panel ctrl search" role="search">
        <div class="tag-list body" role="menu">
            <!-- tags generated by blog-index.js -->
            <button class="dark checkbox tag icon-tag placeholder"></button>
        </div>
    </div>

    {%- macro postEntry(m) %}
    <li class="post-entry" itemprop="blogPosts" itemscope itemtype="http://schema.org/BlogPosting">
        <div class="title">
            <h2 itemprop="headline">
                <a class="title-link" itemprop="url"
                    href="{{m.name}}/" title="{{m.title}}"
                    {%- if !m.robots -%} nofollow {%- endif %}
                 >
                    {{m.title}}
                </a>
            </h2>
            <time class="ctime secondary" itemprop="datePublished" datetime="{{m.ctime|ISOString}}">{{m.ctime|date}}</time>
            <meta class="tags" content="{{m.tags}}" />
            <meta class="mtime" itemprop="dateModified" content="{{m.mtime|ISOString}}" />
        </div>
        <div class="brief" itemprop="description">
            {{m.briefHTML|safe}}
        </div>
        <div class="footer">
            <a class="icon-angle-double-right continue-reading" href="{{m.name}}/"
               title="{{m.title}}" {%- if !m.robots -%} nofollow {%- endif %}
            >继续阅读</a>
        </div>
    </li>
    {% endmacro -%}

    <ul class='panel post-list box multiline' role="article"
        itemscope itemtype="http://schema.org/Blog">
    {%- for $ in articles %}
        {{- postEntry($) -}}
    {% endfor -%}
    </ul>

    <div class="panel warn no-match" aria-hidden="true">
        <h3>Oops. Nothing found!</h3>
        <p>You seems to enter this page from a incorrect link elsewhere.</p>
        <button class="dark button view-all">View all blog posts</button>
    </div>

</article>
</div>

{{ common.footer() }}

<script>
    'use strict'
    window.blogIndex = {
        // match postEntry macro, postEntry = $('.post-entry')
        parsePostEntryDOM: function(postEntry) {
            function $$$(sel) { return $(sel, postEntry) }
            function isTag(o) { return typeof o==='string' && o.length }
            return {
                DOMNode:  postEntry,
                title:    $$$('.title').innerText,
                tags:     $$$('.tags').getAttribute('content').split(/\s*,\s*/g).filter(isTag),
                ctime:    new Date( $$$('.ctime').getAttribute('datetime') ),
                mtime:    new Date( $$$('.mtime').getAttribute('content') )
            }
        }
    }
</script>
<script src="blog-index.js" data-embed></script>

</body>

</html>
